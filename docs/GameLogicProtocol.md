# Протокол общения

## Основные структуры

### GameState
Состояние игры, возвращаемое игровой логикой.
```jsonc lines
{
  // закончена ли игра
  "is_terminal": bool,

  // глобальное состояние игры, передается логике вместе с ходами
  "global_state": str, 
  
  // состояния, которые будут посылаться на клиент 
  // своя строка для каждого игрока
  "players_state": [str,  str, ...],
  
  // номера игроков, победивших в партии
  // имеет смысл только при "is_terminal" = true
  "winners": [int, int, ...]
}
```


### GameMove
Ход игрока, передаваемый игровой логике
```jsonc lines
{
  // номер игрока (в рамках данной партии)
  // если равно -1 - инициализация новой сессии (остальные поля не имеют значения)
  "player_id": int,
  
  // ход, полученный с клиента
  "move": str,
  
  // текущее глобальное состояние игры (после предыдущего хода)
  // получено из хранилища
  "global_state": str
}
```

## Взаимодействие с логикой

### Исполняемый файл
Разработчик загружает исполняемый файл, в который по `stdin` передается `GameMove`, из `stdout` получается `GameState` (все в формате JSON).

Для создания таких файлов предоставляется header-only библиотека `cavoke.h` (находится в папке `games`), подключив которую разработчику нужно реализовать две функции:

* `GameState init_state()`
* `GameState apply_move(GameMove)`

Обработку потоков ввода/вывода, парсинг JSON и т. д. `cavoke.h` берет на себя.
